<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Hospital Triage System with Chatbot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr 400px;
            gap: 20px;
            max-width: 1800px;
            width: 100%;
            padding: 20px;
            height: 95vh;
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .triage-panel {
            max-height: 90vh;
            overflow-y: auto;
        }

        .chatbot-panel {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 25px;
            font-size: 24px;
            font-weight: 600;
        }

        h2 {
            color: #34495e;
            margin-bottom: 20px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .symptom-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .symptom-group h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .symptom-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .symptom-row label {
            margin-bottom: 0;
            flex: 1;
            font-weight: normal;
        }

        .severity-select {
            width: 120px;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .priority-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 12px;
            text-transform: uppercase;
        }

        .priority-1 { background: #e74c3c; color: white; }
        .priority-2 { background: #f39c12; color: white; }
        .priority-3 { background: #f1c40f; color: #2c3e50; }
        .priority-4 { background: #2ecc71; color: white; }
        .priority-5 { background: #95a5a6; color: white; }

        .queue-item {
            background: white;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .queue-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .queue-item h4 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .queue-item p {
            color: #7f8c8d;
            font-size: 14px;
            margin: 3px 0;
        }

        .alert {
            background: #e74c3c;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #3498db;
        }

        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
            text-transform: uppercase;
        }

        /* Chatbot Styles */
        .chat-header {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
            max-height: calc(100vh - 300px);
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            animation: fadeInUp 0.3s ease;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }

        .bot-avatar {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .user-avatar {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        .message-content {
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 18px;
            max-width: 80%;
            word-wrap: break-word;
            border: 1px solid #e1e8ed;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
            padding-top: 15px;
            border-top: 1px solid #e1e8ed;
        }

        .chat-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 25px;
            font-size: 14px;
            resize: none;
        }

        .chat-send-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .chat-send-btn:hover {
            transform: scale(1.1);
        }

        .quick-responses {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .quick-response {
            background: white;
            border: 2px solid #3498db;
            color: #3498db;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-response:hover {
            background: #3498db;
            color: white;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 10px;
            color: #7f8c8d;
            font-style: italic;
            padding: 10px;
        }

        .typing-dots {
            display: flex;
            gap: 3px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #7f8c8d;
            border-radius: 50%;
            animation: typingDot 1.5s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingDot {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .chatbot-panel {
                height: 500px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Triage Input Panel -->
        <div class="panel triage-panel">
            <h1>🏥 AI Hospital Triage System</h1>
            
            <form id="triageForm">
                <div class="form-group">
                    <label for="patientName">Patient Name:</label>
                    <input type="text" id="patientName" required>
                </div>

                <div class="form-group">
                    <label for="patientAge">Age:</label>
                    <input type="number" id="patientAge" min="0" max="120" required>
                </div>

                <div class="form-group">
                    <label for="patientGender">Gender:</label>
                    <select id="patientGender" required>
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="symptom-group">
                    <h3>🩺 Vital Signs & Symptoms</h3>
                    
                    <div class="symptom-row">
                        <label>Pain Level (1-10):</label>
                        <select class="severity-select" id="painLevel">
                            <option value="0">None (0)</option>
                            <option value="2">Mild (1-3)</option>
                            <option value="5">Moderate (4-6)</option>
                            <option value="8">Severe (7-8)</option>
                            <option value="10">Excruciating (9-10)</option>
                        </select>
                    </div>

                    <div class="symptom-row">
                        <label>Breathing Difficulty:</label>
                        <select class="severity-select" id="breathingDifficulty">
                            <option value="0">None</option>
                            <option value="3">Mild</option>
                            <option value="6">Moderate</option>
                            <option value="9">Severe</option>
                        </select>
                    </div>

                    <div class="symptom-row">
                        <label>Consciousness Level:</label>
                        <select class="severity-select" id="consciousnessLevel">
                            <option value="0">Alert</option>
                            <option value="4">Drowsy</option>
                            <option value="7">Confused</option>
                            <option value="10">Unconscious</option>
                        </select>
                    </div>
                </div>

                <div class="symptom-group">
                    <h3>🫀 Cardiovascular Symptoms</h3>
                    
                    <div class="symptom-row">
                        <label>Chest Pain:</label>
                        <select class="severity-select" id="chestPain">
                            <option value="0">None</option>
                            <option value="4">Mild</option>
                            <option value="7">Moderate</option>
                            <option value="10">Severe</option>
                        </select>
                    </div>

                    <div class="symptom-row">
                        <label>Heart Rate Issues:</label>
                        <select class="severity-select" id="heartRate">
                            <option value="0">Normal</option>
                            <option value="3">Slightly irregular</option>
                            <option value="6">Very fast/slow</option>
                            <option value="9">Extremely irregular</option>
                        </select>
                    </div>
                </div>

                <div class="symptom-group">
                    <h3>🧠 Neurological Symptoms</h3>
                    
                    <div class="symptom-row">
                        <label>Severe Headache:</label>
                        <select class="severity-select" id="headache">
                            <option value="0">None</option>
                            <option value="2">Mild</option>
                            <option value="5">Moderate</option>
                            <option value="8">Severe</option>
                        </select>
                    </div>

                    <div class="symptom-row">
                        <label>Confusion/Disorientation:</label>
                        <select class="severity-select" id="confusion">
                            <option value="0">None</option>
                            <option value="4">Mild</option>
                            <option value="7">Moderate</option>
                            <option value="10">Severe</option>
                        </select>
                    </div>
                </div>

                <div class="symptom-group">
                    <h3>🩸 Other Critical Symptoms</h3>
                    
                    <div class="symptom-row">
                        <label>Bleeding:</label>
                        <select class="severity-select" id="bleeding">
                            <option value="0">None</option>
                            <option value="3">Minor</option>
                            <option value="6">Moderate</option>
                            <option value="10">Severe/Uncontrolled</option>
                        </select>
                    </div>

                    <div class="symptom-row">
                        <label>Fever:</label>
                        <select class="severity-select" id="fever">
                            <option value="0">Normal (98.6°F)</option>
                            <option value="2">Low (99-101°F)</option>
                            <option value="5">High (101-103°F)</option>
                            <option value="7">Very High (103°F+)</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="additionalSymptoms">Additional Symptoms/Notes:</label>
                    <textarea id="additionalSymptoms" rows="3" placeholder="Describe any other symptoms or relevant medical history..."></textarea>
                </div>

                <button type="submit" class="btn">🔍 Calculate Triage Priority</button>
            </form>
        </div>

        <!-- Queue Management Panel -->
        <div class="panel">
            <h2>📋 Emergency Queue Management</h2>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalPatients">0</div>
                    <div class="stat-label">Total Patients</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="criticalPatients">0</div>
                    <div class="stat-label">Critical</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgWaitTime">0</div>
                    <div class="stat-label">Avg Wait (min)</div>
                </div>
            </div>

            <div id="criticalAlert" class="alert" style="display: none;">
                ⚠️ CRITICAL PATIENT ALERT: Immediate medical attention required!
            </div>

            <div id="queueContainer" style="overflow-y: auto; max-height: calc(100vh - 400px);">
                <p style="text-align: center; color: #7f8c8d; margin-top: 50px;">
                    No patients in queue. Add patients using the triage form.
                </p>
            </div>
        </div>

        <!-- Chatbot Panel -->
        <div class="panel chatbot-panel">
            <div class="chat-header">
                🤖 Medical Assistant AI
            </div>

            <div class="quick-responses">
                <div class="quick-response" onclick="sendQuickMessage('How does triage work?')">How does triage work?</div>
                <div class="quick-response" onclick="sendQuickMessage('What are emergency signs?')">Emergency signs?</div>
                <div class="quick-response" onclick="sendQuickMessage('Help with symptoms')">Help with symptoms</div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="message">
                    <div class="message-avatar bot-avatar">🤖</div>
                    <div class="message-content">
                        Hello! I'm your medical assistant AI. I can help you understand the triage process, identify emergency symptoms, and answer questions about your visit. How can I assist you today?
                    </div>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                <div class="message-avatar bot-avatar">🤖</div>
                <div>
                    AI is typing
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            </div>

            <div class="chat-input-container">
                <textarea 
                    class="chat-input" 
                    id="chatInput" 
                    placeholder="Ask me about symptoms, triage process, or medical concerns..."
                    rows="2"
                    onkeypress="handleChatKeyPress(event)"
                ></textarea>
                <button class="chat-send-btn" onclick="sendMessage()">➤</button>
            </div>
        </div>
    </div>

    <script>
        // Fuzzy Logic Implementation for Hospital Triage
        class FuzzyTriageSystem {
            constructor() {
                this.patients = [];
                this.patientId = 1;
            }

            // Fuzzy membership functions
            triangularMembership(x, a, b, c) {
                if (x <= a || x >= c) return 0;
                if (x === b) return 1;
                if (x < b) return (x - a) / (b - a);
                return (c - x) / (c - b);
            }

            trapezoidalMembership(x, a, b, c, d) {
                if (x <= a || x >= d) return 0;
                if (x >= b && x <= c) return 1;
                if (x < b) return (x - a) / (b - a);
                return (d - x) / (d - c);
            }

            // Define fuzzy sets for pain level
            painFuzzification(pain) {
                return {
                    none: this.trapezoidalMembership(pain, 0, 0, 1, 2),
                    mild: this.triangularMembership(pain, 0, 2, 4),
                    moderate: this.triangularMembership(pain, 2, 5, 7),
                    severe: this.triangularMembership(pain, 5, 8, 10),
                    extreme: this.trapezoidalMembership(pain, 8, 9, 10, 10)
                };
            }

            // Define fuzzy sets for breathing difficulty
            breathingFuzzification(breathing) {
                return {
                    normal: this.trapezoidalMembership(breathing, 0, 0, 1, 2),
                    mild: this.triangularMembership(breathing, 0, 3, 5),
                    moderate: this.triangularMembership(breathing, 3, 6, 8),
                    severe: this.trapezoidalMembership(breathing, 6, 8, 9, 9)
                };
            }

            // Define fuzzy sets for consciousness
            consciousnessFuzzification(consciousness) {
                return {
                    alert: this.trapezoidalMembership(consciousness, 0, 0, 1, 2),
                    drowsy: this.triangularMembership(consciousness, 1, 4, 6),
                    confused: this.triangularMembership(consciousness, 4, 7, 9),
                    unconscious: this.trapezoidalMembership(consciousness, 7, 9, 10, 10)
                };
            }

            // Calculate age factor
            calculateAgeFactor(age) {
                if (age < 2) return 1.3;      // Infant
                if (age < 12) return 1.2;     // Child
                if (age < 65) return 1.0;     // Adult
                if (age < 80) return 1.1;     // Senior
                return 1.2;                   // Elderly
            }

            // Main fuzzy inference system
            calculateTriagePriority(symptoms, age) {
                const pain = this.painFuzzification(parseFloat(symptoms.painLevel) || 0);
                const breathing = this.breathingFuzzification(parseFloat(symptoms.breathingDifficulty) || 0);
                const consciousness = this.consciousnessFuzzification(parseFloat(symptoms.consciousnessLevel) || 0);
                
                const chestPain = parseFloat(symptoms.chestPain) || 0;
                const heartRate = parseFloat(symptoms.heartRate) || 0;
                const bleeding = parseFloat(symptoms.bleeding) || 0;
                const fever = parseFloat(symptoms.fever) || 0;
                const headache = parseFloat(symptoms.headache) || 0;
                const confusion = parseFloat(symptoms.confusion) || 0;

                let urgencyScore = 0;

                // Critical rules (Priority 1 - Life threatening)
                if (consciousness.unconscious > 0.5 || 
                    breathing.severe > 0.7 || 
                    bleeding >= 10 ||
                    chestPain >= 10) {
                    urgencyScore = 95;
                }
                // High urgency rules (Priority 2 - Urgent)
                else if (consciousness.confused > 0.5 ||
                         breathing.moderate > 0.6 ||
                         pain.extreme > 0.6 ||
                         chestPain >= 7 ||
                         heartRate >= 9 ||
                         bleeding >= 6) {
                    urgencyScore = 75;
                }
                // Moderate urgency (Priority 3 - Less urgent)
                else if (pain.severe > 0.5 ||
                         breathing.mild > 0.5 ||
                         fever >= 5 ||
                         headache >= 8 ||
                         confusion >= 7) {
                    urgencyScore = 55;
                }
                // Low urgency (Priority 4 - Non-urgent)
                else if (pain.moderate > 0.5 ||
                         fever >= 2 ||
                         headache >= 5) {
                    urgencyScore = 35;
                }
                // Minimal urgency (Priority 5 - Minimal)
                else {
                    urgencyScore = 15;
                }

                // Apply age factor
                const ageFactor = this.calculateAgeFactor(age);
                urgencyScore *= ageFactor;

                // Defuzzification - convert to priority level
                let priority;
                let priorityLabel;
                let estimatedWaitTime;

                if (urgencyScore >= 85) {
                    priority = 1;
                    priorityLabel = "CRITICAL - Immediate";
                    estimatedWaitTime = 0;
                } else if (urgencyScore >= 65) {
                    priority = 2;
                    priorityLabel = "HIGH - Within 15 min";
                    estimatedWaitTime = 15;
                } else if (urgencyScore >= 45) {
                    priority = 3;
                    priorityLabel = "MODERATE - Within 30 min";
                    estimatedWaitTime = 30;
                } else if (urgencyScore >= 25) {
                    priority = 4;
                    priorityLabel = "LOW - Within 60 min";
                    estimatedWaitTime = 60;
                } else {
                    priority = 5;
                    priorityLabel = "MINIMAL - Within 120 min";
                    estimatedWaitTime = 120;
                }

                return {
                    priority,
                    priorityLabel,
                    urgencyScore: Math.round(urgencyScore),
                    estimatedWaitTime
                };
            }

            addPatient(patientData, symptoms) {
                const triageResult = this.calculateTriagePriority(symptoms, patientData.age);
                
                const patient = {
                    id: this.patientId++,
                    name: patientData.name,
                    age: patientData.age,
                    gender: patientData.gender,
                    symptoms: symptoms,
                    additionalSymptoms: patientData.additionalSymptoms,
                    arrivalTime: new Date(),
                    priority: triageResult.priority,
                    priorityLabel: triageResult.priorityLabel,
                    urgencyScore: triageResult.urgencyScore,
                    estimatedWaitTime: triageResult.estimatedWaitTime
                };

                // Insert patient in correct position based on priority and arrival time
                let insertIndex = 0;
                for (let i = 0; i < this.patients.length; i++) {
                    if (this.patients[i].priority > patient.priority) {
                        break;
                    } else if (this.patients[i].priority === patient.priority && 
                               this.patients[i].arrivalTime > patient.arrivalTime) {
                        break;
                    }
                    insertIndex = i + 1;
                }
                
                this.patients.splice(insertIndex, 0, patient);
                return patient;
            }

            getPatients() {
                return this.patients;
            }

            getStatistics() {
                const total = this.patients.length;
                const critical = this.patients.filter(p => p.priority === 1).length;
                const avgWait = total > 0 ? 
                    Math.round(this.patients.reduce((sum, p) => sum + p.estimatedWaitTime, 0) / total) : 0;
                
                return { total, critical, avgWait };
            }
        }

        // Medical Chatbot System
        class MedicalChatbot {
            constructor() {
                this.responses = {
                    greetings: [
                        "Hello! I'm here to help you with medical questions and triage information.",
                        "Hi there! How can I assist you with your medical concerns today?",
                        "Welcome! I'm your medical assistant AI. What would you like to know?"
                    ],
                    triageProcess: [
                        "Triage is a process used in emergency rooms to prioritize patients based on the severity of their condition. We use 5 priority levels:",
                        "Priority 1 (Critical): Immediate life-threatening conditions - seen immediately",
                        "Priority 2 (High): Urgent but not immediately life-threatening - within 15 minutes",
                        "Priority 3 (Moderate): Serious but stable - within 30 minutes",
                        "Priority 4 (Low): Less urgent conditions - within 60 minutes",
                        "Priority 5 (Minimal): Non-urgent conditions - within 2 hours"
                    ],
                    emergencySigns: [
                        "🚨 Call 911 immediately if you experience any of these emergency warning signs:",
                        "• Difficulty breathing or shortness of breath",
                        "• Chest pain or pressure",
                        "• Severe bleeding that won't stop",
                        "• Signs of stroke (sudden confusion, trouble speaking, face drooping)",
                        "• Loss of consciousness",
                        "• Severe allergic reactions",
                        "• High fever with stiff neck",
                        "• Severe abdominal pain"
                    ],
                    symptoms: {
                        pain: "Pain levels help us prioritize care. Rate from 1-10: 1-3 is mild, 4-6 moderate, 7-8 severe, 9-10 excruciating. Severe pain (7+) gets higher priority.",
                        fever: "Fever indicates infection. Normal is 98.6°F. Low-grade: 99-101°F, High: 101-103°F, Very high: 103°F+. High fevers need prompt attention.",
                        breathing: "Breathing difficulty is serious. Any trouble breathing, especially at rest, needs immediate evaluation.",
                        chest: "Chest pain can indicate heart problems. Sharp, crushing, or radiating chest pain needs urgent care.",
                        bleeding: "Bleeding severity: Minor cuts heal naturally, moderate needs pressure/bandaging, severe/uncontrolled requires immediate care.",
                        headache: "Severe headaches, especially sudden onset or with fever/stiff neck, can indicate serious conditions."
                    },
                    waitTimes: "Wait times depend on your triage priority and current patient load. Critical patients are seen immediately, while less urgent cases may wait longer during busy periods.",
                    preparation: [
                        "To help us serve you better, please prepare:",
                        "• List of current medications",
                        "• Insurance information and ID",
                        "• Recent medical history",
                        "• Contact information for emergency contacts",
                        "• Description of current symptoms and when they started"
                    ]
                };
                
                this.currentContext = '';
            }

            analyzeMessage(message) {
                const msg = message.toLowerCase();
                
                // Emergency detection
                if (this.containsEmergencyKeywords(msg)) {
                    return this.getEmergencyResponse(msg);
                }
                
                // Symptom questions
                if (msg.includes('pain') || msg.includes('hurt')) {
                    return this.responses.symptoms.pain;
                }
                if (msg.includes('fever') || msg.includes('temperature')) {
                    return this.responses.symptoms.fever;
                }
                if (msg.includes('breath') || msg.includes('breathing')) {
                    return this.responses.symptoms.breathing;
                }
                if (msg.includes('chest')) {
                    return this.responses.symptoms.chest;
                }
                if (msg.includes('bleed') || msg.includes('blood')) {
                    return this.responses.symptoms.bleeding;
                }
                if (msg.includes('headache') || msg.includes('head')) {
                    return this.responses.symptoms.headache;
                }
                
                // Process questions
                if (msg.includes('triage') || msg.includes('priority') || msg.includes('how') && msg.includes('work')) {
                    return this.responses.triageProcess.join('\n\n');
                }
                if (msg.includes('emergency') || msg.includes('urgent') || msg.includes('serious')) {
                    return this.responses.emergencySigns.join('\n');
                }
                if (msg.includes('wait') || msg.includes('time') || msg.includes('long')) {
                    return this.responses.waitTimes;
                }
                if (msg.includes('prepare') || msg.includes('bring') || msg.includes('need')) {
                    return this.responses.preparation.join('\n');
                }
                
                // Greetings
                if (msg.includes('hello') || msg.includes('hi') || msg.includes('help')) {
                    return this.responses.greetings[Math.floor(Math.random() * this.responses.greetings.length)];
                }
                
                // Default response with helpful suggestions
                return "I can help you with:\n• Understanding the triage process\n• Identifying emergency symptoms\n• Information about wait times\n• What to prepare for your visit\n• Symptom guidance\n\nWhat specific information would you like?";
            }

            containsEmergencyKeywords(msg) {
                const emergencyKeywords = [
                    'can\'t breathe', 'cannot breathe', 'difficulty breathing', 'shortness of breath',
                    'chest pain', 'heart attack', 'stroke', 'unconscious', 'severe bleeding',
                    'allergic reaction', 'overdose', 'suicide', 'choking'
                ];
                return emergencyKeywords.some(keyword => msg.includes(keyword));
            }

            getEmergencyResponse(msg) {
                return "🚨 EMERGENCY ALERT 🚨\n\nIf you're experiencing a life-threatening emergency, please:\n• Call 911 immediately\n• Go to the nearest emergency room\n• Don't delay seeking immediate medical attention\n\nThis chatbot is for information only and cannot replace emergency medical care.";
            }

            generateResponse(message) {
                return new Promise((resolve) => {
                    // Simulate AI thinking time
                    setTimeout(() => {
                        const response = this.analyzeMessage(message);
                        resolve(response);
                    }, 1000 + Math.random() * 2000);
                });
            }
        }

        // Initialize systems
        const triageSystem = new FuzzyTriageSystem();
        const chatbot = new MedicalChatbot();

        // Chat functionality
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessage(message, 'user');
            input.value = '';
            
            showTypingIndicator();
            
            chatbot.generateResponse(message).then(response => {
                hideTypingIndicator();
                addMessage(response, 'bot');
            });
        }

        function sendQuickMessage(message) {
            addMessage(message, 'user');
            showTypingIndicator();
            
            chatbot.generateResponse(message).then(response => {
                hideTypingIndicator();
                addMessage(response, 'bot');
            });
        }

        function addMessage(message, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatarDiv = document.createElement('div');
            avatarDiv.className = `message-avatar ${sender}-avatar`;
            avatarDiv.textContent = sender === 'bot' ? '🤖' : '👤';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.style.whiteSpace = 'pre-line';
            contentDiv.textContent = message;
            
            messageDiv.appendChild(avatarDiv);
            messageDiv.appendChild(contentDiv);
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'flex';
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Form submission handler
        document.getElementById('triageForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const patientData = {
                name: document.getElementById('patientName').value,
                age: parseInt(document.getElementById('patientAge').value),
                gender: document.getElementById('patientGender').value,
                additionalSymptoms: document.getElementById('additionalSymptoms').value
            };

            const symptoms = {
                painLevel: document.getElementById('painLevel').value,
                breathingDifficulty: document.getElementById('breathingDifficulty').value,
                consciousnessLevel: document.getElementById('consciousnessLevel').value,
                chestPain: document.getElementById('chestPain').value,
                heartRate: document.getElementById('heartRate').value,
                headache: document.getElementById('headache').value,
                confusion: document.getElementById('confusion').value,
                bleeding: document.getElementById('bleeding').value,
                fever: document.getElementById('fever').value
            };

            const patient = triageSystem.addPatient(patientData, symptoms);
            updateQueue();
            
            // Chatbot notification
            const triageMessage = `Patient ${patient.name} has been added to the queue with ${patient.priorityLabel} priority (Score: ${patient.urgencyScore}/100).`;
            addMessage(triageMessage, 'bot');
            
            // Reset form
            this.reset();
            
            // Show alert for critical patients
            if (patient.priority === 1) {
                showCriticalAlert();
                addMessage('🚨 CRITICAL PATIENT ALERT: This patient requires immediate medical attention!', 'bot');
            }
        });

        function updateQueue() {
            const patients = triageSystem.getPatients();
            const stats = triageSystem.getStatistics();
            const queueContainer = document.getElementById('queueContainer');
            
            // Update statistics
            document.getElementById('totalPatients').textContent = stats.total;
            document.getElementById('criticalPatients').textContent = stats.critical;
            document.getElementById('avgWaitTime').textContent = stats.avgWait;
            
            if (patients.length === 0) {
                queueContainer.innerHTML = '<p style="text-align: center; color: #7f8c8d; margin-top: 50px;">No patients in queue. Add patients using the triage form.</p>';
                return;
            }
            
            queueContainer.innerHTML = patients.map((patient, index) => `
                <div class="queue-item">
                    <h4>#${index + 1} - ${patient.name}</h4>
                    <p><strong>Age:</strong> ${patient.age} | <strong>Gender:</strong> ${patient.gender}</p>
                    <p><strong>Priority:</strong> <span class="priority-badge priority-${patient.priority}">${patient.priorityLabel}</span></p>
                    <p><strong>Urgency Score:</strong> ${patient.urgencyScore}/100</p>
                    <p><strong>Est. Wait Time:</strong> ${patient.estimatedWaitTime} minutes</p>
                    <p><strong>Arrival:</strong> ${patient.arrivalTime.toLocaleTimeString()}</p>
                    ${patient.additionalSymptoms ? `<p><strong>Notes:</strong> ${patient.additionalSymptoms}</p>` : ''}
                </div>
            `).join('');
        }

        function showCriticalAlert() {
            const alert = document.getElementById('criticalAlert');
            alert.style.display = 'block';
            setTimeout(() => {
                alert.style.display = 'none';
            }, 10000);
        }

        // Initialize with empty queue
        updateQueue();
    </script>
</body>
</html>